angular.module("hbp-common-templates",["templates/breadcrumb.html","templates/content-description.html","templates/content-icon.html","templates/dialog-alert.html","templates/dialog-confirmation.html","templates/error-alert.html","templates/error-message.html","templates/icon.html","templates/userSelector.html","templates/usercard.html"]),angular.module("templates/breadcrumb.html",[]).run(["$templateCache",function(a){a.put("templates/breadcrumb.html",'<ol class="breadcrumb">\n    <li ng-repeat="item in parentItems"\n        ><a ng-href="{{urlForState(item.state, item.stateParams)}}"\n            ><hbp-icon type="item.type"></hbp-icon>\n            <span class="breadcrumb-item-name {{item.class}}">{{item.name}}</span\n        ></a\n    ></li\n    ><li\n        ><hbp-icon type="currentItem.type"></hbp-icon>\n        <span class="breadcrumb-item-name {{currentItem.class}}">{{currentItem.name}}</span\n    ></li>\n</ol>\n')}]),angular.module("templates/content-description.html",[]).run(["$templateCache",function(a){a.put("templates/content-description.html",'<span ng-switch="content">\n    <span ng-switch-when="application/vnd.bbp.FeatureExtract.Dependency+txt">Text FeatureExtract</span>\n    <span ng-switch-when="application/vnd.bbp.SimulationProtocol.StimulationConfig">Simulation Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.SimulationProtocol.ReportingConfig">Reporting Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Config+config">Circuit Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Config">Circuit Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Combination">Circuit Combination</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Combination+xml">XML Circuit Combination</span>\n    <span ng-switch-when="application/vnd.bbp.Simulation.BlueConfig">BlueConfig File</span>\n    <span ng-switch-when="application/vnd.bbp.Simulation.HOC">HOC Simulation</span>\n    <span ng-switch-when="application/vnd.bbp.bundle.Image.png">Image Bundle</span>\n    <span ng-switch-when="application/zip">Archive</span>\n    <span ng-switch-when="application/rar">Archive</span>\n    <span ng-switch-when="application/json">JSON</span>\n    <span ng-switch-when="application/txt">Plain Text</span>\n    <span ng-switch-when="text/plain">Plain Text</span>\n    <span ng-switch-when="image/jpeg">JPEG Image</span>\n    <span ng-switch-when="image/png">PNG Image</span>\n    <span ng-switch-when="image/gif">GIF Image</span>\n    <span ng-switch-when="video/avi">AVI Video</span>\n    <span ng-switch-when="video/mpg">MPEG Video</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology">Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology+asc">ASCI Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology+h5">H5 Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.NeuronDB">DAT NeuronDB</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.NeuronDB+dat">DAT NeuronDB</span>\n    <span ng-switch-default>{{fallback}}</span>\n</span>\n')}]),angular.module("templates/content-icon.html",[]).run(["$templateCache",function(a){a.put("templates/content-icon.html",'<span class="bbp-browser-entity-icon" ng-switch="content">\n    <i ng-switch-when="application/zip" class="fa fa-file-archive-o"></i>\n    <i ng-switch-when="application/rar" class="fa fa-file-archive-o"></i>\n    <i ng-switch-when="application/txt" class="fa fa-file-text-o"></i>\n    <i ng-switch-when="text/plain" class="fa fa-file-text-o"></i>\n    <i ng-switch-when="application/pdf" class="fa fa-file-pdf-o"></i>\n    <i ng-switch-when="image/jpeg" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="image/png" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="image/gif" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="application/json" class="fa fa-file-code-o"></i>\n    <i ng-switch-when="video/avi" class="fa fa-file-video-o"></i>\n    <i ng-switch-when="video/mpeg" class="fa fa-file-video-o"></i>\n    <i ng-switch-default class="fa fa-file-o"></i>\n</span>\n')}]),angular.module("templates/dialog-alert.html",[]).run(["$templateCache",function(a){a.put("templates/dialog-alert.html",'<div class="modal-header"  >\n    <button type="button" class="close" ng-click="$close()" aria-hidden="true">&times;</button>\n    <h4 class="modal-title">{{title}}</h4>\n</div>\n<div class="modal-body {{htmlClass}}">\n    <ng-include src="alertContentUrl"></ng-include>\n    {{alertContent}}\n</div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="$close()">{{label}}</button>\n</div>\n')}]),angular.module("templates/dialog-confirmation.html",[]).run(["$templateCache",function(a){a.put("templates/dialog-confirmation.html",'<div class="modal-header"  >\n    <button type="button" ng-show="closable" class="close" ng-click="$dismiss(\'cancel\')" aria-hidden="true">&times;</button>\n    <h4 class="modal-title">{{title}}</h4>\n</div>\n<div class="modal-body">\n    <alert ng-if="error" type="danger">{{error.reason}}</alert>\n    <ng-include ng-if="confirmationContentUrl" src="confirmationContentUrl"></ng-include>\n    {{confirmationContent}}\n</div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="$dismiss(\'cancel\')">{{cancelLabel}}</button>\n    <button class="btn btn-danger" ng-click="$close()">{{confirmLabel}}</button>\n</div>\n')}]),angular.module("templates/error-alert.html",[]).run(["$templateCache",function(a){a.put("templates/error-alert.html",'<div class="alert alert-danger">[{{error.type}}] {{error.message}}</div>\n<pre><code>{{error | json}}</code></pre>\n')}]),angular.module("templates/error-message.html",[]).run(["$templateCache",function(a){a.put("templates/error-message.html",'<alert type="danger" ng-if="error">\n    <div ng-switch on="error.type">\n        <div ng-switch-when="Validation">\n                Validation errors<span ng-show="error.data">:</span>\n            <ul>\n            <li ng-repeat="(attr, errors) in error.data">{{attr}}: {{errors.join(\', \')}}</li>\n        </ul>\n        </div>\n        <div ng-switch-default>\n            {{error.message}}\n        </div>\n    </div>\n</alert>')}]),angular.module("templates/icon.html",[]).run(["$templateCache",function(a){a.put("templates/icon.html",'<span class="bbp-browser-entity-icon" ng-switch="type">\n    <i ng-switch-when="root" class="glyphicon glyphicon-home"></i>\n    <i ng-switch-when="project" class="glyphicon glyphicon-hdd"></i>\n    <i ng-switch-when="folder" class="glyphicon glyphicon-folder-open"></i>\n    <i ng-switch-when="file" class="glyphicon glyphicon-file"></i>\n    <i ng-switch-when="release" class="glyphicon glyphicon-lock"></i>\n    <i ng-switch-when="link:folder" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:file" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:project" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:release" class="glyphicon glyphicon-link"></i>\n</span>\n')}]),angular.module("templates/userSelector.html",[]).run(["$templateCache",function(a){a.put("templates/userSelector.html",'<div class="input-group hbp-user-selector" ng-class="{\'has-error\': false}">\n    <input class="form-control" ng-model="newUser" type="text" placeholder="type user name"\n      typeahead="user as user.displayName for user in getUsers($viewValue)"\n      typeahead-editable="false"\n      typeahead-on-select="selectUser()"\n      typeahead-min-length="3"\n      ng-keypress="noSubmitOnEnter($event)"\n      name="new-user"\n      ng-disabled="selectionDisabled">\n    <span class="input-group-btn">\n      <button ng-click="selectUser()" class="btn btn-default" type="button"><i class="glyphicon glyphicon-plus"></i></button>\n    </span>\n</div>')}]),angular.module("templates/usercard.html",[]).run(["$templateCache",function(a){a.put("templates/usercard.html",'<div ng-if="user" class="hbp-usercard hbp-card hbp-card-default">\n    <h3 class="hbp-usercard-name">\n        {{user.displayName}}\n    </h3>\n    <div class="hbp-usercard-pix">\n        <img ng-src="{{user.picture}}" ng-if="user.picture" />\n        <hbp-generated-icon hbp-text="user.displayName" ng-if="!user.picture"></hbp-generated-icon>\n    </div>\n    <div class="hbp-usercard-institution" ng-if="institution">\n        <span class="hbp-usercard-institution-title">{{institution.title}}</span>,\n        <span class="hbp-usercard-institution-name">{{institution.name}}</span>,\n        <span class="hbp-usercard-institution-dept">{{institution.department}}</span>\n    </div>\n    <div class="hbp-usercard-contact">\n        <a class="hbp-usercard-contact-item hbp-usercard-email" target="_top" href="mailto:{{email}}" ng-if="email"><span class="glyphicon glyphicon-envelope"></span> {{email}}</a>\n        <span class="hbp-usercard-contact-item hbp-usercard-phone" ng-if="phone"><span class="glyphicon glyphicon-phone"></span> {{phone}}</span>\n        <span class="hbp-usercard-contact-item hbp-usercard-im-list" ng-if="ims.length"><span class="glyphicon glyphicon-bullhorn"></span>\n            <span class="hbp-usercard-im" ng-repeat="im in ims">\n                {{im.value}}({{im.type}})\n            </span>\n        </span>\n    </div>\n</div>\n')}]),function(){"use strict";function a(a,b,c){function d(b){return a.reject(c.httpError(b))}function e(a,b){return new f(a,b).promise}function f(d,e){function f(){return o(function(){return q.hasNext?b.get(q.nextUrl).then(h):a.reject(i)})}function g(){return o(function(){return q.hasPrevious?b.get(q.previousUrl).then(j):a.reject(i)})}function h(a){var b=a.data;return q.results.push.apply(q.results,b[e.resultKey]),n(b),l(b),q}function j(a){var b=a.data;return q.results.unshift.apply(q.results,b[e.resultKey]),n(b),m(b),q}function k(b){return q.error=c.httpError(b),angular.isFunction(e.errorHandler)&&e.errorHandler(q.error),a.reject(q.error)}function l(a){q.nextUrl=a[e.nextUrlKey],q.hasNext=!!q.nextUrl}function m(a){q.previousUrl=a[e.previousUrlKey],q.hasPrevious=!!q.previousUrl}function n(a){a.count&&(q.count=a.count)}function o(b){return q.promise=a.when(q.promise.then(b))["catch"](k),q.promise.instance=q,q.promise}function p(a){return h(a),m(a.data),q}var q=this;q.results=[],q.error=null,q.hasNext=null,q.hasPrevious=null,q.promise=null,q.errorHandler=null,q.next=f,q.previous=g,q.count=-1,e=angular.extend({resultKey:"results",nextUrlKey:"next",previousUrlKey:"previous"},e),q.promise=a.when(d).then(p)["catch"](k),q.promise.instance=q}function g(a,b){return angular.isArray(b)||(b=[b]),a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}function h(a){return _.isArray(a)?a:[a]}var i=c.error({type:"ResultSet::EOL",message:"End of list reached"}),j={format:g,paginatedResultSet:e,ferr:d,ResultSetEOL:i,arrayOf:h};return j}angular.module("hbpUtil",[]).factory("hbpUtil",a),a.$inject=["$q","$http","hbpErrorService"]}(),angular.module("hbpIdentity",["hbpUtil","bbpConfig"]),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a){return c.get(o+a).then(function(a){return a.data},f.ferr)}function i(a){return f.paginatedResultSet(c.get(o+a+"/members"))}function j(a,b){var d={users:f.arrayOf(b)};return f.paginatedResultSet(c.put(o+a+"/members",d))}function k(a,b){var d={users:f.arrayOf(b)};return f.paginatedResultSet(c({method:"DELETE",url:o+a+"/members",data:d,headers:{"Content-Type":"application/json"}}))}function l(a){var c=n.get(a);return c?b.when(c):m({filter:{name:a}}).then(function(c){return 1===c.results.length?(n.put(a,c.results[0]),c.results[0]):0===c.results.length?void 0:b.reject(hbpErrorService.error({type:"UnexpectedResult",message:"More than one result has been retrieved"}))})}function m(a){var b=g.queryParams(a);return f.paginatedResultSet(c.get(o,{params:b}))}var n=d("hbpGroupsCache"),o=e.get("api.user.v0")+"/group/",p={get:h,getByName:l,getMembers:i,addMembers:j,removeMembers:k,list:m};return p}angular.module("hbpIdentity").factory("hbpIdentityGroupStore",a),a.$inject=["$rootScope","$q","$http","$cacheFactory","bbpConfig","hbpUtil","hbpIdentityUtil"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h=d("hbpUserCache"),i=e.get("api.user.v0"),j=i+"/user",k=i+"/group",l="_currentUser_",m="S12578";a.$on("user:disconnected",function(){h.removeAll()});var n=function(a,b,c){if(a.length>0){for(var d=b+a[0],e=1;e<a.length;e++)d.length+a[e].length+1<2e3?d+="%2B"+a[e]:(c.push(d),d=b+a[e]);c.push(d)}},o=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];void 0===d.displayName&&(d.displayName=d.name),b[d.id]=d,h.put(d.id,d)}},p=function(a){var d=b.defer(),e=[],f=[],g={},i=[],l=function(){d.reject.apply(d,a)},m=function(a){return o(a.data.result,g),i&&i.length>0?c.get(i.shift()).then(m,l):void d.resolve(g)};return _.forEach(a,function(a){var b=h.get(a);b?g[a]=b:"S"===a[0]?f.push(a):e.push(a)}),e.length+f.length===0?d.resolve(g):(n(e,j+"?filter=id=",i),n(f,k+"?filter=id=",i),c.get(i.shift()).then(m,l)),d.promise},q=function(a){return this.getCurrentUser().then(function(b){var c=_.isArray(a)?a:[a];return _.some(c,function(a){return b.groups.indexOf(a)>-1})})};return{get:p,getCurrentUserOnly:function(){var a=h.get(l);return a?b.when(a):c.get(j+"/me").then(function(a){var b=a.data;return h.put(l,b),b},f.ferr)},getCurrentUser:function(){var a=h.get(l);if(a&&a.groups)return b.when(a);var d={};return a||(d.user=this.getCurrentUserOnly()),d.groups=c.get(j+"/me/groups"),b.all(d).then(function(b){var c=b.user||a;return c.groups=b.groups.data.result,h.put(l,c),c},f.ferr)},create:function(a){return c.post(j,a).then(function(){return a},f.ferr)},update:function(a,b){b=b||a;var d="string"==typeof a?a:a.id;return c.put(j+"/"+d,b).then(function(){h.remove(d);var a=h.get(l);return a&&a.id===d&&h.remove(l),p([d]).then(function(a){return _.first(_.values(a))})},f.ferr)},list:function(a){var b=g.queryParams(a),d=j;return a&&a.managedOnly&&(d+="/managed"),f.paginatedResultSet(c.get(d,{params:b}),{resultKey:"result"})},isAdmin:function(){return this.getCurrentUser().then(function(a){return a.groups&&a.groups.indexOf(m)>-1})},isGroupMember:q}}angular.module("hbpIdentity").factory("hbpIdentityUserDirectory",a),a.$inject=["$rootScope","$q","$http","$cacheFactory","bbpConfig","hbpUtil","hbpIdentityUtil"]}(),function(){"use strict";function a(){var a={queryParams:b};return a}function b(a){var b,c={page:0,pageSize:10},d=angular.extend(c,a);if(d.filter){var e=_.map(d.filter,function(a,b){return _.isArray(a)&&(a=a.join("+")),b+"="+a});b=e.join()}var f;return d.sort&&(f=_.isArray(d.sort)?d.sort.join():_(d.sort).toString()),{page:d.page,pageSize:d.pageSize,filter:b,sort:f}}angular.module("hbpIdentity").factory("hbpIdentityUtil",a)}(),angular.module("hbpCommonUI",["ui.bootstrap"]),angular.module("hbpCommon",["hbp-common-templates","ui.router","bbpConfig","bbpOidcClient","hbpUtil","hbpIdentity","hbpCommonUI"]),window.hbpCommonVersion="2.0.0-dev.3",angular.module("hbpCommon").controller("hbpMetaNavigationCtrl",["$rootScope","$scope","$state","hbpIdentityUserDirectory","bbpOidcSession",function(a,b,c,d,e){"use strict";d.getCurrentUser().then(function(a){b.currentUser=a}),b.logout=function(){e.logout().then(function(){a.$broadcast("user:disconnected"),b.currentUser=null})}}]),angular.module("hbpCommon").directive("hbpBreadcrumb",["$state",function(a){"use strict";return{restrict:"E",templateUrl:"templates/breadcrumb.html",scope:{items:"="},link:function(b){var c=function(b,c){return a.href(b,c)},d=function(){b.parentItems=b.items&&b.items.slice(0,b.items.length-1),b.currentItem=b.items&&b.items[b.items.length-1]},e=function(){b.$watch("items",d),b.urlForState=c,d()};e()}}}]),angular.module("hbpCommon").directive("hbpContentDescription",function(){"use strict";return{templateUrl:"templates/content-description.html",restrict:"E",scope:{content:"=?"},link:function(a){if(a.content){var b=a.content.split("/");b.length>1?a.fallback=b[1]:a.fallback=b[0]}}}}),angular.module("hbpCommon").directive("hbpContentIcon",function(){"use strict";return{templateUrl:"templates/content-icon.html",restrict:"E",scope:{content:"=?"}}}),angular.module("hbpCommon").directive("hbpErrorMessage",function(){return{restrict:"E",scope:{error:"=?hbpError"},templateUrl:"templates/error-message.html"}}),angular.module("hbpCommon").directive("hbpGeneratedIcon",function(){"use strict";return{restrict:"E",scope:{text:"=hbpText",color:"=hbpColor",size:"=?hbpSize"},template:'<canvas width="{{width}}" height="{{height}}" hbp-hires-canvas></canvas>',link:{post:function(a,b){b.addClass("hbp-generated-icon");var c=function(){if(a.text&&a.width&&a.height){var c=b[0].childNodes[0],d=c.width,e=c.height,f=a.text.split(/\s+/,2),g=(""+f[0][0]+(f[1]?f[1][0]:f[0][1])).toUpperCase(),h=a.color;if(!h){var i=["#ee936d","#ea6153","#f8bd93","#308298","#e54639","#4b8f9e","#457493","#456e91"],j=7*g.charCodeAt(0)*13*g.charCodeAt(1)%i.length;h=i[j]}b.attr("style","width:"+a.width+"px; height:"+a.height+"px");var k=b[0].childNodes[0].getContext("2d"),l="Arial",m=176;k.fillStyle=h,k.fillRect(0,0,d,e),k.textAlign="center",k.textBaseline="middle",k.fillStyle="#ffffff";do m-=4,k.font=m+"px "+l;while(m>10&&k.measureText(g).width>.75*d);k.fillText(g,d/2,e/2)}};a.$watch("[text,width,height]",c,!0),a.width=a.size||b[0].offsetWidth,a.height=a.size||b[0].offsetHeight,c()}}}}),angular.module("hbpCommon").directive("hbpHiresCanvas",["hbpHiResService",function(a){"use strict";return{link:{post:function(b,c,d){var e=a.pixelRatio(),f=function(a){return function(b){if(b){var d=b;c.css(a,d+"px").prop(a,d*e)}}};a.isHiResScreen()&&c[0].getContext("2d").transform(e,0,0,e,0,0),d.$observe("width",f("width")),d.$observe("height",f("height"))}}}}]),angular.module("hbpCommon").directive("hbpIcon",function(){"use strict";return{templateUrl:"templates/icon.html",restrict:"E",scope:{entity:"=?",type:"=?"},link:function(a){!a.type&&a.entity&&(a.type=a.entity._entityType)}}}),angular.module("hbpCommonUI").directive("hbpLoading",function(){"use strict";return{restrict:"E",scope:{promise:"=hbpPromise",message:"=hbpMessage"},template:'<div class="hbp-loading" ng-if="loading"><span class="glyphicon glyphicon-refresh hbp-spinning"></span> {{message}}</div>',link:function(a){if(a.loading=!0,a.message=a.message||"Loading...",a.promise){var b=function(){a.loading=!1};a.promise.then(b,b)}}}}),angular.module("hbpCommon").directive("hbpOnTouch",["$parse",function(a){"use strict";return{restrict:"A",compile:function(b,c){var d=a(c.hbpOnTouch);return function(a,b){b.on("touchend",function(b){b.preventDefault();var c=function(){d(a,{$event:b})};a.$apply(c)})}}}}]),angular.module("hbpCommonUI").directive("hbpPerformAction",[function(){"use strict";return{restrict:"A",scope:{action:"&hbpPerformAction"},link:function(a,b,c){var d=!1,e=function(){b.html(a.text),b.attr("disabled",!1),b.removeClass("loading"),d=!1},f=function(){d=!0,a.loadingMessage&&b.html(a.loadingMessage),b.addClass("loading"),b.attr("disabled",!0),a.action().then(e,e)};a.loadingMessage=c.hbpLoadingMessage,a.text=a.text||b.html(),b.on("click",f)}}}]),angular.module("hbpCommon").directive("hbpUserSelector",["$q","$http","bbpConfig","hbpUtil","hbpIdentityUserDirectory",function(a,b,c,d,e){"use strict";return{restrict:"EA",scope:{exclude:"=hbpUserExclude",onUserSelect:"&hbpOnSelect"},templateUrl:function(a,b){return b.hbpTemplate||"templates/userSelector.html"},controller:["$scope",function(b){b.idsToExclude=[],b.$watch("exclude",function(a){a&&a.length>0&&a[0].id?b.idsToExclude=_.pluck(b.exclude,"id"):a&&(b.idsToExclude=a)}),b.noSubmitOnEnter=function(a){13===a.which&&a.preventDefault()},b.getUsers=function(a){var c=[];return e.list({filter:{displayName:"*"+a+"*"}}).then(function(a){return _.forEach(a.results,function(a){b.idsToExclude.indexOf(a.id)<0&&c.push(a)}),c},d.ferr)},b.selectUser=function(){var c=b.onUserSelect({user:b.newUser});b.selectionDisabled=!0;var d=function(){b.selectionDisabled=!1,b.newUser=""};a.when(c).then(d,d)}}]}}]),angular.module("hbpCommon").directive("hbpUsercard",function(){"use strict";return{restrict:"EA",scope:{user:"=hbpUser"},templateUrl:function(a,b){return b.hbpTemplate||"templates/usercard.html"},link:{pre:function(a){a.$watch("user",function(b){a.institution=b&&_.find(b.institutions,"primary"),a.email=b&&_(b.emails).filter("primary").pluck("value").first(),a.phone=b&&_(b.phones).filter("primary").pluck("value").first(),a.ims=b&&b.ims})}}}}),angular.module("hbpCommon").filter("hbpDollarToNewLine",function(){"use strict";return function(a){return a&&a.replace(/ \$ /g,"\n")}}),angular.module("hbpCommon").filter("hbpYesNo",function(){"use strict";return function(a){return!a||["0","false","no"].indexOf(a.toString().toLowerCase())>-1?"No":"Yes"}}),angular.module("hbpCommon").service("hbpCollabStore",["$log","$q","$cacheFactory","$http","bbpConfig","hbpIdentityUserDirectory","hbpErrorService","hbpUtil",function(a,b,c,d,e,f,g,h){var i=null,j=e.get("api.collab.v0"),k=j+"/collab/",l=j+"/mycollabs/",m=k+"context/",n=c("hbpCollabStoreCollabs"),o=this.Collab=function(){};o.prototype={toJson:function(){return{id:this.id,title:this.title,content:this.content}},update:function(a){_.each(["id","title","content"],function(b){void 0!==a[b]&&(this[b]=a[b])},this)}},o.fromJson=function(a){if(a.toJson)return a;var b=new o;return b.id=a.id,b.created=new Date(a.created),b.edited=new Date(a.edited),b.title=a.title,b.content=a.content,b.deleted=a.deleted,b.toJson=function(){return{id:a.id,title:b.title,content:b.content,deleted:b.deleted}},b};var p=this.Context=function(){};p.fromJson=function(a){var b=new p;return b.context=a.context,b.appId=a.app_id,b.name=a.name,b.navId=a.id,b.collab=o.fromJson(a.collab),b.toJson=function(){return{context:a.context,appId:a.app_id,name:b.name}},b};var q={},r=function(a){var c=n.get(a);return c?b.when(c):q[a]?q[a]:void 0},s=function(a,c){if(!c)return b.reject(g.error({message:"id parameter is required"}));var e=r(c);return e?e:(q[c]=d.get(a+c+"/").then(function(a){return q[c]=null,o.fromJson(a.data)},function(a){return q[c]=null,h.ferr(a)}),q[c])},t=function(a,b){return a._label||(a._label=b,n.put(b,a),n.put(a.id,a)),a};this.get=function(a){return a=a&&a.id||a,s(k,a).then(function(a){return n.put(a.id,a),a})},this.getByLabel=function(a){return s(j+"/r/",a).then(function(b){var c=r(b.id);return c?c.then(function(b){return t(b,a)}):t(b,a)})},this.list=function(a){var b,c=k;return angular.isString(a)&&(c=a,a=arguments[1]),a=angular.extend({},a),angular.isArray(a.id)&&(a.id=a.id.join(",")),a.pageSize&&(a.page_size=a.pageSize),b=a.url?d.get(a.url):d.get(c,{params:angular.extend({},a.params,_.pick(a,["search","id","page_size","page"]))}),h.paginatedResultSet(b,{factory:o.fromJson})};var u=function(a){a=angular.extend({},a);var b=angular.extend({},_.pick(a,["search"]));return h.paginatedResultSet(d.get(l,{params:b}),{factory:o.fromJson})};this.mine=u,this.create=function(a){var b=o.fromJson(a);return d.post(k,b.toJson()).then(function(a){return b.update(a.data),n.put(b.id,b),b},h.ferr)},this.save=function(a){var b=o.fromJson(a);return d.put(k+b.id+"/",b).then(function(a){return b.update(a.data),n.put(b.id,b),b},h.ferr)},this["delete"]=function(a){return d["delete"](k+a.id+"/").then(function(){n.remove(a.id),a._label&&n.remove(a._label)},h.ferr)};var v={};this.context={get:function(a){return a?v[a]?v[a]:(v[a]=d.get(m+a+"/",{cache:!0}).then(function(b){return v[a]=null,p.fromJson(b.data)},function(b){return v[a]=null,h.ferr(b)}),v[a]):b.reject(g.error({message:"uuid parameter is required"}))}};var w={},x=function(a){return b.when(a)};this.team={add:function(a,b){return d.put(k+a+"/team/",{users:[b]}).then(i,h.ferr)},"delete":function(a,b){return d({method:"DELETE",url:k+a+"/team/",data:{users:[b]},headers:{"Content-Type":"application/json"}}).then(i,h.ferr)},list:function(a){return d.get(k+a+"/team/").then(function(b){var c=_.indexBy(b.data,"user_id");return f.list({pageSize:0,filter:{id:_.keys(c)}}).then(function(b){return _.reduce(b.results,function(b,d){var e=c[parseInt(d.id,10)];return e&&(w[a]||(w[a]={}),w[a][e.user_id]=e.role,b.push(angular.extend({},d,{membershipId:e.user_id,role:e.role}))),b},[])})},h.ferr)},userInTeam:function(a){return f.getCurrentUserOnly().then(function(b){return d.get(k+a+"/team/").then(function(a){return void 0!==_.indexBy(a.data,"user_id")[parseInt(b.id,10)]})})},roles:{get:function(b,c){return c?(w[b]||(w[b]={}),w[b]&&w[b][c]?x(w[b][c]):d.get(k+b+"/team/role/"+c+"/").then(function(a){return w[b][c]=a.data.role,x(w[b][c])},function(a){return 404===a.status?(w[b][c]=void 0,x(w[b][c])):void h.ferr(a)})):void a.debug("Must provide userId: ",b,c)},set:function(a,b,c){var e=k+a+"/team/role/"+b+"/";return w[a]&&w[a][b]?(w[a][b]=c,d.put(e,{role:c}).then(i,function(a){return 404===a.status?d.post(e,{role:c}).then(i,h.ferr):h.ferr(a)})):(w[a]||(w[a]={}),w[a][b]=c,d.post(e,{role:c}).then(i,h.ferr))}}}}]),angular.module("hbpCommon").service("hbpConfigStore",["$http","bbpConfig","hbpUtil",function(a,b,c){var d=b.get("api.collab.v0")+"/config/";this.get=function(b){return a.get(d+b+"/").then(function(a){return a.data},c.ferr)},this.list=function(a){return c.getList(d,a)()},this.create=function(b){return a.post(d,b).then(function(a){return a.data},c.ferr)},this.save=function(b){return a.put(d+b.context+"/",b).then(function(a){return a.data},c.ferr)},this["delete"]=function(b){a["delete"](d+b.context+"/").then(null,c.ferr)}}]),angular.module("hbpCommon").factory("hbpDialogFactory",["$modal","$log","$q","$rootScope","$compile","$templateCache","hbpErrorService",function(a,b,c,d,e,f,g){"use strict";function h(b){b=_.extend({scope:d,title:"Confirm",confirmLabel:"Yes",cancelLabel:"No",template:"Are you sure?",closable:!0},b);var c=b.scope.$new();c.title=b.title,c.confirmLabel=b.confirmLabel,c.cancelLabel=b.cancelLabel,c.confirmationContent=b.template,c.confirmationContentUrl=b.templateUrl,c.closable=b.closable;var e=a.open({templateUrl:"templates/dialog-confirmation.html",show:!0,backdrop:"static",scope:c,keyboard:b.keyboard||b.closable});return e.result}function i(a){var b=d.$new();return b.error=a,j({"class":"error",title:"Error!",label:"Close",scope:b,templateUrl:"templates/error-alert.html"})}function j(b){if("string"==typeof b)return k.apply(window,arguments);b=_.extend({scope:d,title:"Message",label:"Close","class":"default"},b);var c=b.scope.$new();c.title=b.title,c.label=b.label,c.alertContentUrl=b.templateUrl,c.alertContent=b.template,c.htmlClass=b["class"];var e=a.open({templateUrl:"templates/dialog-alert.html",show:!0,backdrop:"static",scope:c});return e.result}function k(a,c,d){return b.warn("hbpDialogFactory.alert(templateUrl, title, scope) is deprecated."),b.log("Use hbpDialogFactory.alert(options) instead"),j({templateUrl:a,title:c,scope:d})}return{alert:j,error:i,confirm:h,confirmation:function(a,d,e,f,i){return b.warn("hbpDialogFactory.confirmation is deprecated."),b.log("Use hbpDialogFactory.confirm instead"),h({scope:i,title:e,confirmLabel:f,cancelLabel:"cancel",templateUrl:a}).then(function(){return d?d(i).then(null,function(a){var b;return"string"==typeof a?b=g.error({type:"Error",message:a}):a?(a.status||(a={status:-1,data:a}),b=g.httpError(a)):b=g.error(),j({title:"Error","class":"alert-danger",template:b.message}),c.reject(b)}):void 0})}}}]),angular.module("hbpCommon").service("hbpErrorService",function(){"use strict";var a=function(a){a=angular.extend({type:"UnknownError",message:"An unknown error occured.",code:-1},a),this.type=a.type,this.message=a.message,this.data=a.data,this.code=a.code};return{httpError:function(b){if(b&&b instanceof a)return b;if(void 0===b.status)return new a({message:"Cannot parse error, invalid format."});var c=new a({code:b.status});if(0===c.code)return c.type="ClientError",c.message="The client cannot run the request.",c;if(404===c.code)return c.type="NotFound",c.message="Resource not found",c;if(403===c.code)return c.type="Forbidden",c.message="Permission denied: you are not allowed to display the page or perform the operation",c;if(502===c.code){if(c.type="BadGateway",c.message="502 Bad Gateway Error","text/html"===b.headers("content-type")){var d=document.createElement("div");d.innerHTML=b.data;var e=d.getElementsByTagName("title")[0];e&&(c.message=e.innerHTML)}return c}if(b.data){var f=b.data;f.error&&(f=f.error),f.type&&(c.type=f.type),f.data&&(c.data=f.data),f.message?c.message=f.message:f.reason&&(c.type="Error",c.message=f.reason),f.type||f.data||f.message||f.reason||(c.data=f)}return c},error:function(b){return b&&b instanceof a?b:new a(b)}}}),angular.module("hbpCommon").service("hbpHiResService",function(){"use strict";return{isHiResScreen:function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)").matches},pixelRatio:function(){return window.devicePixelRatio||1}}}),angular.module("hbpCommon").service("hbpUiUtil",["$window","$document","$q","hbpErrorService",function(a,b,c,d){"use strict";function e(c){c.find&&(c=c[0]);var d=c.getBoundingClientRect();return d.top>=0&&d.left>=0&&d.bottom<=(a.innerHeight||b.documentElement.clientHeight)&&d.right<=(a.innerWidth||b.documentElement.clientWidth)}var f=function(a,b){return function(e){var f=Array.prototype.slice.call(arguments);return f.shift(),a.apply(this,f).then(function(a){e(a)},function(a){b.error=d.httpError(a),c.reject(b.error)})}};return{isInViewport:e,dialogSubmissionRestCallErrorHandler:f}}]).filter("hbpDatetime",["$filter",function(a){"use strict";return function(b){return a("date")(b,"yyyy-MM-dd HH:mm:ss")}}]).filter("hbpCapitalize",[function(){"use strict";return function(a){return a.charAt().toUpperCase()+a.substring(1)}}]).filter("hbpMarkdown",["$sce",function(a){"use strict";return function(b){return void 0!==b?a.trustAsHtml(marked(b,{sanitize:!0})):void 0}}]).run(["$rootScope","$log","$state","$stateParams","$location","$window",function(a,b,c,d,e,f){"use strict";var g=0;a.$on("$stateChangeSuccess",function(a,b,c,d){d&&d.name&&!e.$$replace&&g++}),a.goToPrevious=function(a,d){g>0?(g--,f.history.go(-1)):a?c.go(a,d):b.error("no previous state, cannot navigate back.")}}]),angular.module("hbpCommon").config(["$httpProvider",function(a){"use strict";window.XMLHttpRequest=function(a){return function(){var b=new a;return b.setRequestHeader=function(a){return function(c,d){"HBP-AngularProgressEventMixin"===c?d.call(b,b):a.apply(this,arguments)}}(b.setRequestHeader),b}}(window.XMLHttpRequest),a.interceptors.push("hbpXhrProgressEventInterceptor")}]).factory("hbpXhrProgressEventInterceptor",function(){"use strict";return{request:function(a){return(a.uploadProgress||a.progress)&&(a.headers["HBP-AngularProgressEventMixin"]=function(b){a.uploadProgress&&b.upload.addEventListener("progress",a.uploadProgress,!1),a.progress&&b.addEventListener("progress",a.progress,!1)}),a}}});